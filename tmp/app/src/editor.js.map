{"version":3,"sources":["../../../app/src/editor.js"],"names":[],"mappings":"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","file":"editor.js","sourcesContent":["import EditorState from \"./editor-state\";\n\nlet _history = [];\nlet _currentStateIndex = 0;\nlet _tempState = {};\n\nclass Editor {\n    constructor(file) {\n        var reader = new FileReader();\n        var me = this;\n\n        this.canvas = document.createElement('canvas');\n        this.canvas.setAttribute('id', 'editorCanvas');\n        this.canvasContext = this.canvas.getContext(\"2d\");\n        this.fileName = file.name;\n        this.mimeType = file.type;\n        this.lastModifiedDate = file.lastModifiedDate;\n        this.fileSize = file.size;\n\n        this.scale = this.scale.bind(this);\n        this.move = this.move.bind(this);\n        this.draw = this.draw.bind(this);\n        this.setState = this.saveState.bind(this);\n        this.currentState = this.currentState.bind(this);\n\n        //SetData from image\n        reader.onload = function (e) {\n            var firstState;\n\n            me.originalImage = document.createElement('img');\n            me.originalImage.setAttribute('src', e.target.result);\n            me.description = me.originalImage.longDesc;\n            me.name = me.originalImage.name || me.fileName;\n\n            firstState = new EditorState({\n                image: me.originalImage,\n                clipStartX: 0,\n                clipStartY: 0,\n                clipWidth: me.originalImage.naturalWidth,\n                clipHeight: me.originalImage.naturalHeight,\n                imageStartX: 0,\n                imageStartY: 0,\n                imageWidth: me.originalImage.naturalWidth,\n                imageHeight: me.originalImage.naturalHeight,\n                canvasWidth: me.originalImage.naturalWidth,\n                canvasHeight: me.originalImage.naturalHeight,\n                rotation : 0\n            });\n\n            _history.push(firstState);\n            _currentStateIndex = 0;\n            me.draw();\n        };\n\n        reader.readAsDataURL(file);\n    }\n\n    scale(percentage) {\n        console.log(\"scale\" + percentage + \"%\");\n        var newHeight = this.originalImage.height * percentage * .01;\n        var newWidth = this.originalImage.width * percentage * .01;\n        this.imageState.width = newWidth;\n        this.imageState.height = newHeight;\n        this.canvas.width = newWidth;\n        this.canvas.height = newHeight;\n        this.draw();\n        this.history.push({\n            action: \"zoom\",\n            payload: percentage\n        });\n\n    }\n\n    draw(editorState) {\n        var newState = new EditorState(Object.assign((editorState || {}),{image : _history[_currentStateIndex].image}));\n        console.log('draw1 ' + JSON.stringify(editorState));\n        console.log('draw ' + JSON.stringify(newState));\n\n        //Clear the canvas\n        this.canvasContext.clearRect(0, 0, this.canvas.width, this.canvas.height);\n\n        //Setup Canvas\n        this.canvas.width = newState.canvasWidth;\n        this.canvas.height = newState.canvasHeight;\n        if(!!newState.rotation){\n            this.canvasContext.translate(this.canvas.width / 2, this.canvas.height / 2);\n            this.canvasContext.rotate(rad);\n            this.canvasContext.translate(-this.canvas.width / 2, -this.canvas.height / 2);\n        }\n        //Draw Image\n        this.canvasContext.drawImage(\n            newState.image,\n            newState.clipStartX,\n            newState.clipStartY,\n            newState.clipWidth,\n            newState.clipHeight,\n            newState.imageStartX,\n            newState.imageStartY,\n            newState.imageWidth,\n            newState.imageHeight);\n\n        //Save this state as the last rendered\n        _tempState = newState;\n    }\n\n\n    currentState() {\n        return Object.assign({},_history[_currentStateIndex]);\n    }\n\n    undo(){\n        _currentStateIndex = _currentStateIndex < 0 ? 0 : _currentStateIndex - 1;\n        this.draw();\n    }\n\n    redo(){\n        _currentStateIndex = _currentStateIndex >=(_history.length - 1) ? 0 : _currentStateIndex + 1;\n        this.draw();\n    }\n\n    saveState(){\n       _history  = _history.slice(0,_currentStateIndex).push(_tempState);\n       _currentStateIndex = _history.length - 1;\n\n    }\n\n    drawBox(args) {\n        args = args || {};\n        // console.log('drawBox ' + JSON.stringify(args));\n        this.draw();\n        this.canvasContext.fillStyle = 'rgba(255,255,255,0.5)';\n        this.canvasContext.fillRect((args.sx || 0), (args.sy || 0), (args.swidth || 0), (args.sheight || 0));\n    }\n\n    move(args) {\n        args = args || {};\n        console.log('move ' + JSON.stringify(args));\n        this.imageState.y = this.imageState.y + (args.y || 0);\n        this.imageState.x = this.imageState.x + (args.x || 0);\n        this.draw();\n    }\n\n    crop(args) {\n        args = args || {};\n        console.log('crop ' + JSON.stringify(args));\n        this.imageState.x = 0;\n        this.imageState.y = 0;\n        this.imageState.width = args.swidth;\n        this.imageState.height = args.sheight;\n        this.imageState.sy = (args.sy || 0);\n        this.imageState.sx = (args.sx || 0);\n        this.imageState.swidth = (args.swidth || 0);\n        this.imageState.sheight = (args.sheight || 0);\n        this.canvas.width = args.swidth;\n        this.canvas.height = args.sheight;\n        this.draw();\n    }\n\n    rotate(deg) {\n        var rad = deg * Math.PI / 180;\n        var height = this.canvas.height;\n        var width = this.canvas.width;\n        this.canvasContext.clearRect(0, 0, this.canvas.width, this.canvas.height);\n        this.canvasContext.translate(this.canvas.width / 2, this.canvas.height / 2);\n        this.canvasContext.rotate(rad);\n        this.canvasContext.translate(-this.canvas.width / 2, -this.canvas.height / 2);\n        this.canvas.height = width;\n        this.canvas.width = height;\n        this.draw();\n    }\n\n    save() {\n        var imgdata = this.canvas.toDataURL('imgage/png');\n        // standard data to url\n\n        // modify the dataUrl so the browser starts downloading it instead of just showing it\n        var newdata = imgdata.replace(/^data:image\\/png/, 'data:application/octet-stream');\n        return newdata;\n        // give the link the values it needs\n\n    }\n}\n\nexport default Editor;\n"]}