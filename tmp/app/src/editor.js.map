{"version":3,"sources":["../../../app/src/editor.js"],"names":[],"mappings":"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","file":"editor.js","sourcesContent":["class EditorState{\n    constructor(state){\n            this.clipStartX = state.clipStartX;\n            this.clipStartY = state.clipStartY;\n            this.clipHeight = state.clipHeight;\n            this.clipWidth = state.clipWidth;\n            this.imageStartX = state.imageStartX;\n            this.imageStartY = state.imageStartY;\n            this.imageWidth =  state.imageWidth;\n            this.imageHeight = state.imageHeight;\n            this.canvasWidth = state.canvasWidth;\n            this.canvasHeight = state.canvasHeight;\n    }\n}\n\n\nclass Editor {\n    constructor(file) {\n        var reader = new FileReader();\n        var me = this;\n\n        this.canvas = document.createElement('canvas');\n        this.canvas.setAttribute('id', 'editorCanvas');\n        this.canvasContext = this.canvas.getContext(\"2d\");\n        this.fileName = file.name;\n        this.mimeType = file.type;\n        this.lastModifiedDate = file.lastModifiedDate;\n        this.fileSize = file.size;\n        this.history = [];\n        this.scale = this.scale.bind(this);\n        this.redraw = this.redraw.bind(this);\n        this.move = this.move.bind(this);\n        this.currentState = new EditorState({});\n\n        //SetData from image\n        reader.onload = function (e) {\n            me.originalImage = document.createElement('img');\n            me.originalImage.setAttribute('src', e.target.result);\n            me.imageState.height = me.originalImage.naturalHeight;\n            me.imageState.width = me.originalImage.naturalWidth;\n            me.imageState.swidth = me.originalImage.naturalWidth;\n            me.imageState.sheight = me.originalImage.naturalHeight;\n            me.description = me.originalImage.longDesc;\n            me.name = me.originalImage.name || me.fileName;\n            me.canvas.height = me.originalImage.naturalHeight;\n            me.canvas.width = me.originalImage.naturalWidth;\n            me.canvasContext.drawImage(me.originalImage, 0, 0);\n        };\n\n        reader.readAsDataURL(file);\n    }\n\n    scale(percentage) {\n        console.log(\"scale\" + percentage + \"%\");\n        var newHeight = this.originalImage.height * percentage * .01;\n        var newWidth = this.originalImage.width * percentage * .01;\n        this.imageState.width = newWidth;\n        this.imageState.height = newHeight;\n        this.canvas.width =newWidth;\n        this.canvas.height = newHeight;\n        this.redraw();\n        this.history.push({\n            action: \"zoom\",\n            payload: percentage\n        });\n\n    }\n\n    redraw(args) {\n        args = args || {};\n        console.log('redraw ' + JSON.stringify(args));\n\n        var img = this.originalImage;\n        var sx = args.sx || this.imageState.sx || 0;\n        var sy = args.sy || this.imageState.sy || 0;\n        var swidth = args.swidth || this.imageState.swidth;\n        var sheight = args.sheight || this.imageState.sheight;\n        var x = args.x ? (this.imageState.x || 0) + args.x : (this.imageState.x || 0);\n        var y = args.y ? (this.imageState.y || 0) + args.y : (this.imageState.y || 0);\n        var width = args.width || this.imageState.width;\n        var height = args.height || this.imageState.height;\n\n        //Clear the canvas\n        this.canvasContext.clearRect(0, 0, this.canvas.width, this.canvas.height);\n        this.canvasContext.drawImage(img, sx, sy, swidth, sheight, x, y, width, height)\n    }\n\n    drawBox(args) {\n        args = args || {};\n        // console.log('drawBox ' + JSON.stringify(args));\n        this.redraw();\n        this.canvasContext.fillStyle = 'rgba(255,255,255,0.5)';\n        this.canvasContext.fillRect((args.sx || 0), (args.sy || 0), (args.swidth || 0), (args.sheight || 0));\n    }\n\n\n    move(args) {\n        args = args || {};\n        console.log('move ' + JSON.stringify(args));\n        this.imageState.y = this.imageState.y + (args.y || 0);\n        this.imageState.x = this.imageState.x + (args.x || 0);\n        this.redraw();\n    }\n\n    crop(args) {\n        args = args || {};\n        console.log('crop ' + JSON.stringify(args));\n        this.imageState.x = 0;\n        this.imageState.y = 0;\n        this.imageState.width = args.swidth;\n        this.imageState.height = args.sheight;\n        this.imageState.sy = (args.sy || 0);\n        this.imageState.sx = (args.sx || 0);\n        this.imageState.swidth = (args.swidth || 0);\n        this.imageState.sheight = (args.sheight || 0);\n        this.canvas.width =args.swidth;\n        this.canvas.height = args.sheight;\n        this.redraw();\n    }\n\n    rotate(deg){\n        var rad = deg * Math.PI / 180;\n        var height = this.canvas.height;\n        var width = this.canvas.width;\n        this.canvasContext.clearRect(0, 0, this.canvas.width, this.canvas.height);\n        this.canvasContext.translate(this.canvas.width/2, this.canvas.height/2);\n        this.canvasContext.rotate(rad);\n        this.canvasContext.translate( -this.canvas.width/2, -this.canvas.height/2);\n        this.canvas.height = width;\n        this.canvas.width = height;\n        this.redraw();\n\n    }\n\n    save() {\n        var imgdata = this.canvas.toDataURL('imgage/png');\n        // standard data to url\n\n        // modify the dataUrl so the browser starts downloading it instead of just showing it\n        var newdata = imgdata.replace(/^data:image\\/png/, 'data:application/octet-stream');\n        return newdata;\n        // give the link the values it needs\n\n    }\n}\n\nexport default Editor;\n"]}