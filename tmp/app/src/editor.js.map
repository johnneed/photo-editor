{"version":3,"sources":["../../../app/src/editor.js"],"names":[],"mappings":"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","file":"editor.js","sourcesContent":["import EditorState from \"./editor-state\";\r\n\r\nlet _history = [];\r\nlet _currentStateIndex = 0;\r\nlet _tempState = {};\r\nlet _workingImage;\r\nlet _fireHistoryEvent = function (element) {\r\n\r\n    let historyIndexChange = new CustomEvent(\r\n        \"historyIndexChange\",\r\n        {\r\n            detail: {\r\n                message: \"History Index Changed\",\r\n                history: _history[_currentStateIndex],\r\n                isLast: _currentStateIndex === (_history.length - 1),\r\n                isFirst: (_currentStateIndex === 0),\r\n                index: _currentStateIndex\r\n            },\r\n            bubbles: true,\r\n            cancelable: true\r\n        }\r\n    );\r\n    element.dispatchEvent(historyIndexChange);\r\n\r\n};\r\nlet _fireImageLoadedEvent = function (element) {\r\n    let imageLoaded = new CustomEvent(\r\n        \"imageLoaded\",\r\n        {\r\n            detail: {\r\n                message: \"Image was loaded\",\r\n            },\r\n            bubbles: true,\r\n            cancelable: true\r\n        }\r\n    );\r\n    element.dispatchEvent(imageLoaded);\r\n};\r\nlet _getRotatedDims = function (image, rotation) {\r\n    var newWidth = Math.abs(Math.round(Math.sin(rotation), 10) * image.height - Math.round(Math.cos(rotation), 10) * image.width);\r\n    var newHeight = Math.abs(Math.round(Math.sin(rotation), 10) * image.width - Math.round(Math.cos(rotation), 10) * image.height);\r\n    return {height: newHeight, width: newWidth};\r\n};\r\nlet _zoom = 1;\r\n\r\nwindow.getRotatedDims = _getRotatedDims;\r\nclass Editor {\r\n    constructor(file) {\r\n        var reader = new FileReader();\r\n        var me = this;\r\n        this.canvas = document.createElement('canvas');\r\n        this.canvas.setAttribute('id', 'editorCanvas');\r\n        this.canvasContext = this.canvas.getContext(\"2d\");\r\n        this.fileName = file.name;\r\n        this.mimeType = file.type;\r\n        this.lastModifiedDate = file.lastModifiedDate;\r\n        this.fileSize = file.size;\r\n        this.scale = this.scale.bind(this);\r\n        //this.move = this.move.bind(this);\r\n        this.draw = this.draw.bind(this);\r\n        this.setState = this.saveState.bind(this);\r\n        // this.currentState = this.currentState.bind(this);\r\n\r\n        //SetData from image\r\n        reader.onload = function (e) {\r\n            var firstState;\r\n\r\n            me.originalImage = document.createElement('img');\r\n            me.originalImage.setAttribute('src', e.target.result);\r\n            _workingImage = document.createElement('img')\r\n            _workingImage.setAttribute('src', e.target.result);\r\n            me.description = me.originalImage.longDesc;\r\n            me.name = me.originalImage.name || me.fileName;\r\n\r\n            firstState = ({\r\n                image: me.originalImage\r\n            });\r\n            _history = [firstState];\r\n            _currentStateIndex = 0;\r\n            me.draw(me.originalImage);\r\n            _fireImageLoadedEvent(me.canvas);\r\n            _fireHistoryEvent(me.canvas);\r\n\r\n        };\r\n\r\n        reader.readAsDataURL(file);\r\n    }\r\n\r\n\r\n    crop(args) {\r\n        args = args || {};\r\n        console.log('crop ' + JSON.stringify(args));\r\n        var newHeight = args.height;\r\n        var newWidth = args.width;\r\n        this.canvas.height = newHeight;\r\n        this.canvas.width = newWidth;\r\n        this.canvasContext.clearRect(0, 0, newWidth, newHeight);\r\n        this.canvasContext.drawImage(_history[_currentStateIndex].image, args.x, args.y, newWidth, newHeight, 0, 0, newWidth, newHeight);\r\n\r\n    }\r\n\r\n\r\n    currentState() {\r\n        return Object.assign({}, _history[_currentStateIndex]);\r\n    }\r\n\r\n\r\n    draw(image) {\r\n        this.canvasContext.clearRect(0, 0, image.width, image.height);\r\n        this.canvas.height = image.height * _zoom;\r\n        this.canvas.width = image.width  * _zoom;\r\n        this.canvasContext.drawImage(image, 0, 0, image.width * _zoom, image.height * _zoom);\r\n    }\r\n\r\n    redo() {\r\n        _currentStateIndex = _currentStateIndex >= (_history.length - 1) ? _currentStateIndex : _currentStateIndex + 1;\r\n        this.draw(_history[_currentStateIndex].image);\r\n        _fireHistoryEvent(this.canvas);\r\n\r\n    }\r\n\r\n    redrawImage() {\r\n        this.canvasContext.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n        this.draw(_history[_currentStateIndex].image);\r\n    }\r\n\r\n\r\n    rotate(deg) {\r\n        deg = (deg / Math.abs(deg)) * 90;//just doing a 90 deg rotate for now\r\n        var num = parseFloat(deg);\r\n        var rad = ((isNaN(deg) ? 0 : num) * Math.PI / 180) % (2 * Math.PI);\r\n        var myImage = _history[_currentStateIndex].image;\r\n        if (rad) {\r\n            let newDims = _getRotatedDims(myImage, rad);\r\n            this.canvas.height = newDims.height;\r\n            this.canvas.width = newDims.width;\r\n            this.canvasContext.clearRect(0, 0, myImage.height, myImage.Width);\r\n            this.canvasContext.save();\r\n            this.canvasContext.translate(myImage.height / 2, myImage.width / 2);\r\n            this.canvasContext.rotate(rad);\r\n            this.canvasContext.drawImage(myImage, -(myImage.width / 2), -(myImage.height / 2));\r\n            this.canvasContext.restore();\r\n        } else {\r\n            this.canvas.width = myImage.width;\r\n            this.canvas.height = myImage.height;\r\n            this.canvasContext.drawImage(myImage, 0, 0, myImage.width, myImage.height);\r\n\r\n        }\r\n\r\n    }\r\n\r\n    save() {\r\n        var imgdata = this.canvas.toDataURL(this.mimeType);\r\n        // standard data to url\r\n\r\n        // modify the dataUrl so the browser starts downloading it instead of just showing it\r\n        var newdata = imgdata.replace(/^data:image\\/png/, 'data:application/octet-stream');\r\n        return newdata;\r\n        // give the link the values it needs\r\n\r\n    }\r\n\r\n    saveState() {\r\n        var newImage = document.createElement('img');\r\n        newImage.setAttribute('src', this.canvas.toDataURL(this.mimeType));\r\n        _history = _history.slice(0, _currentStateIndex + 1);\r\n        _history.push({image: newImage});\r\n        _currentStateIndex += 1;\r\n        _fireHistoryEvent(this.canvas);\r\n    }\r\n\r\n    scale(percentage) {\r\n        console.log(\"scale\" + percentage + \"%\");\r\n        var newHeight = this.originalImage.height * percentage * .01;\r\n        var newWidth = this.originalImage.width * percentage * .01;\r\n        this.canvas.height = newHeight;\r\n        this.canvas.width = newWidth;\r\n        this.canvasContext.clearRect(0, 0, newWidth, newHeight);\r\n        this.canvasContext.drawImage(_history[_currentStateIndex].image, 0, 0, _history[_currentStateIndex].image.width, _history[_currentStateIndex].image.height, 0, 0, newWidth, newHeight);\r\n    }\r\n\r\n    undo() {\r\n        _currentStateIndex = _currentStateIndex < 0 ? 0 : _currentStateIndex - 1;\r\n        this.draw(_history[_currentStateIndex].image);\r\n        _fireHistoryEvent(this.canvas);\r\n\r\n    }\r\n\r\n    zoom(percentage) {\r\n        if(!percentage){\r\n            return _zoom * 100;\r\n        }\r\n        if (typeof percentage === 'number' && percentage > 0 ) {\r\n            _zoom = percentage / 100;\r\n            this.draw(_history[_currentStateIndex].image);\r\n            return _zoom * 100;\r\n        } else {\r\n            throw new Error(\"zoom parameters must be of type number. You passed : \" + percentage);\r\n        }\r\n\r\n\r\n    }\r\n\r\n\r\n}\r\n\r\nexport default Editor;\r\n"]}