{"version":3,"sources":["../../../app/src/editor.js"],"names":[],"mappings":"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","file":"editor.js","sourcesContent":["import EditorState from \"./editor-state\";\n\nlet _history = [];\nlet _currentStateIndex = 0;\nlet _tempState = {};\nlet _workingImage;\n\n\nclass Editor {\n    constructor(file) {\n        var reader = new FileReader();\n        var me = this;\n\n        this.canvas = document.createElement('canvas');\n        this.canvas.setAttribute('id', 'editorCanvas');\n        this.canvasContext = this.canvas.getContext(\"2d\");\n        this.fileName = file.name;\n        this.mimeType = file.type;\n        this.lastModifiedDate = file.lastModifiedDate;\n        this.fileSize = file.size;\n\n        this.scale = this.scale.bind(this);\n        //this.move = this.move.bind(this);\n        this.draw = this.draw.bind(this);\n        this.setState = this.saveState.bind(this);\n        // this.currentState = this.currentState.bind(this);\n\n        //SetData from image\n        reader.onload = function (e) {\n            var firstState;\n\n            me.originalImage = document.createElement('img');\n            me.originalImage.setAttribute('src', e.target.result);\n            _workingImage = document.createElement('img')\n            _workingImage.setAttribute('src', e.target.result);\n            me.description = me.originalImage.longDesc;\n            me.name = me.originalImage.name || me.fileName;\n\n            firstState = ({\n                image: me.originalImage\n            });\n\n            _history.push(firstState);\n            _currentStateIndex = 0;\n            me.draw(me.originalImage);\n        };\n\n        reader.readAsDataURL(file);\n    }\n\n    scale(percentage) {\n        console.log(\"scale\" + percentage + \"%\");\n        var newHeight = _history[_currentStateIndex].image.height * percentage * .01;\n        var newWidth = _history[_currentStateIndex].image.width * percentage * .01;\n        this.canvas.height = newHeight;\n        this.canvas.width = newWidth;\n        this.canvasContext.clearRect(0, 0, newWidth, newHeight);\n        this.canvasContext.drawImage(_history[_currentStateIndex].image, 0, 0, _history[_currentStateIndex].image.width,_history[_currentStateIndex].image.height, 0, 0, newWidth, newHeight);\n\n    }\n\n    draw(image) {\n\n        var myImage;\n        this.canvas.height = image.height;\n        this.canvas.width = image.width;\n        this.canvasContext.clearRect(0, 0, image.width, image.height);\n        this.canvasContext.drawImage(image, 0, 0, image.width, image.height);\n\n    }\n\n\n    static currentState() {\n        return Object.assign({}, _history[_currentStateIndex]);\n    }\n\n    undo() {\n        _currentStateIndex = _currentStateIndex < 0 ? 0 : _currentStateIndex - 1;\n        this.draw(_history[_currentStateIndex].image);\n    }\n\n    redo() {\n        _currentStateIndex = _currentStateIndex >= (_history.length - 1) ? 0 : _currentStateIndex + 1;\n        this.draw(_history[_currentStateIndex].image);\n    }\n\n    saveState() {\n        var newImage = document.createElement('img');\n        newImage.setAttribute('src', this.canvas.toDataURL(this.mimeType));\n        _history = _history.slice(0, _currentStateIndex + 1);\n        _history.push({image: newImage});\n        _currentStateIndex += 1;\n        console.log(_history);\n    }\n\n    drawBox(args) {\n        args = args || {};\n        // console.log('drawBox ' + JSON.stringify(args));\n        this.draw();\n        this.canvasContext.fillStyle = 'rgba(255,255,255,0.5)';\n        this.canvasContext.fillRect((args.x || 0), (args.y || 0), (args.width || 0), (args.height || 0));\n    }\n\n    //move(args) {\n    //    console.log(args);\n    //    args = args || {};\n    //    imageStartX: args.x, imageStartY: args.y;\n    //    newState.combine(_history[_currentStateIndex]);\n    //    this.draw(newState);\n    //}\n\n    crop(args) {\n        args = args || {};\n        console.log('crop ' + JSON.stringify(args));\n        var newHeight = args.height;\n        var newWidth = args.width;\n        this.canvas.height = newHeight;\n        this.canvas.width = newWidth;\n        this.canvasContext.clearRect(0, 0, newWidth, newHeight);\n        this.canvasContext.drawImage(_history[_currentStateIndex].image, args.x, args.y, newWidth, newHeight, 0, 0, newWidth, newHeight);\n\n    }\n\n    rotate(deg) {\n\n        var num = parseFloat(deg);\n        var rad = (isNaN(deg) ? 0 : num) * Math.PI / 180;\n\n        switch (Math.abs(newState.rotation)) {\n            case  Math.PI / 2 :\n                this.canvas.height = myImage.width;\n                this.canvas.width = myImage.height;\n                this.canvasContext.save();\n                this.canvasContext.clearRect(0, 0, this.canvas.width, this.canvas.height);\n                this.canvasContext.translate(myImage.height / 2, myImage.width / 2);\n                this.canvasContext.rotate(newState.rotation);\n                this.canvasContext.drawImage(myImage, -(myImage.width / 2), -(myImage.height / 2));\n                myImage.src = this.canvas.toDataURL(this.mimeType);\n                this.canvasContext.restore();\n                newState.image = myImage;\n                newState.canvasHeight = myImage.height;\n                newState.canvasWidth = myImage.width;\n\n                break;\n\n            case  Math.PI :\n                this.canvas.width = myImage.width;\n                this.canvas.height = myImage.height;\n                this.canvasContext.save();\n                this.canvasContext.translate(myImage.height / 2, myImage.width / 2);\n                this.canvasContext.rotate(newState.rotation);\n                this.canvasContext.drawImage(myImage, -(myImage.width / 2), -(myImage.height / 2));\n                myImage.src = this.canvas.toDataURL(this.mimeType);\n                this.canvasContext.restore();\n                newState.image = myImage;\n                newState.canvasHeight = myImage.height;\n                newState.canvasWidth = myImage.width;\n                break;\n\n            case Math.PI * 1.5:\n                this.canvas.height = myImage.width;\n                this.canvas.width = myImage.height;\n                this.canvasContext.save();\n                this.canvasContext.clearRect(0, 0, this.canvas.width, this.canvas.height);\n                this.canvasContext.translate(myImage.height / 2, myImage.width / 2);\n                this.canvasContext.rotate(newState.rotation);\n                this.canvasContext.drawImage(myImage, -(myImage.width / 2), -(myImage.height / 2));\n                myImage.src = this.canvas.toDataURL(this.mimeType);\n                this.canvasContext.restore();\n                newState.image = myImage;\n                newState.canvasHeight = myImage.height;\n                newState.canvasWidth = myImage.width;\n                break;\n\n            default:\n                this.canvas.width = myImage.width;\n                this.canvas.height = myImage.height;\n                this.canvasContext.drawImage(\n                    myImage,\n                    newState.clipStartX,\n                    newState.clipStartY,\n                    newState.clipWidth,\n                    newState.clipHeight,\n                    newState.imageStartX,\n                    newState.imageStartY,\n                    newState.imageWidth,\n                    newState.imageHeight);\n                break;\n        }\n\n\n    }\n\n    save() {\n        var imgdata = this.canvas.toDataURL(this.mimeType);\n        // standard data to url\n\n        // modify the dataUrl so the browser starts downloading it instead of just showing it\n        var newdata = imgdata.replace(/^data:image\\/png/, 'data:application/octet-stream');\n        return newdata;\n        // give the link the values it needs\n\n    }\n}\n\nexport default Editor;\n"]}